<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1280">
    <title>DAMS - Department Asset Management System</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font/css/materialdesignicons.min.css" rel="stylesheet">
    <style>
       :root {
    --primary-color: #006666; /* Deep teal */
    --primary-hover: #004D4D; /* Darker teal for hover */
    --sidebar-bg: #0A1733; /* Deep navy (unchanged) */
    --main-bg: #0A1733; /* Deep navy (unchanged) */
    --card-bg: #1C2A44; /* Lighter navy (unchanged) */
    --border-color: #2A3A5A; /* Even lighter navy (unchanged) */
    --text-primary: #FFFFFF; /* White (unchanged) */
    --text-secondary: #A9B7C0; /* Soft silver-blue */
    --success-color: #00C853; /* Green for success */
    --warning-color: #FF9800; /* Orange for warnings */
    --danger-color: #F44336; /* Red for danger */
    --table-header-bg: #1C2A44; /* Lighter navy (unchanged) */
    --table-row-hover: #2A3A5A; /* Even lighter navy (unchanged) */
    --table-row-even: #0A1733; /* Deep navy (unchanged) */
    --neon-glow: #006666; /* Deep teal glow */
    --particle-color: rgba(0, 102, 102, 0.5); /* Semi-transparent teal */
}

[data-theme="light"] {
    --main-bg: #E8ECEF; /* Light blue-gray (unchanged) */
    --card-bg: #FFFFFF; /* White (unchanged) */
    --sidebar-bg: #D6E0FA; /* Very light blue (unchanged) */
    --text-primary: #0A1733; /* Deep navy (unchanged) */
    --text-secondary: #666666; /* Dark gray (unchanged) */
    --border-color: #B0BEC5; /* Light blue-gray (unchanged) */
    --table-header-bg: #D6E0FA; /* Light blue (unchanged) */
    --table-row-hover: #E8ECEF; /* Lighter blue-gray (unchanged) */
    --table-row-even: #F5F7FA; /* Very light blue (unchanged) */
    --primary-color: #006666; /* Deep teal */
    --primary-hover: #004D4D; /* Darker teal */
}

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Orbitron', sans-serif;
            cursor: none;
        }

        body {
            background: var(--main-bg);
            color: var(--text-primary);
            overflow-x: hidden;
            overflow-y: auto;
            position: relative;
            min-height: 100vh;
        }

        .mobile-warning {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            color: #fff;
            justify-content: center;
            align-items: center;
            text-align: center;
            z-index: 10000;
            padding: 20px;
            font-size: 18px;
        }

  /* Add at the end of the existing CSS, before the @media queries */
/* ===== Holographic Dashboard Styles ===== */
.holographic-display {
    position: relative;
    background: rgba(0, 102, 102, 0.1);
    border-radius: 20px;
    padding: 20px;
    margin-bottom: 30px;
    overflow: hidden;
    border: 2px solid #00ffff;
    box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
    backdrop-filter: blur(10px);
}

.particle-container {
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    pointer-events: none;
    z-index: 0;
}

.hologram-card {
    background: rgba(0, 102, 102, 0.2);
    border: 1px solid #00ffff;
    border-radius: 10px;
    padding: 15px;
    margin: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
    z-index: 1;
}

.hologram-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 0 20px rgba(0, 255, 255, 0.4);
}

.view-form-btn {
    background: linear-gradient(45deg, #006666, #00ffff);
    border: none;
    padding: 8px 15px;
    border-radius: 5px;
    cursor: pointer;
    margin-top: 10px;
    font-family: 'Orbitron', sans-serif;
}

/* Add particle animation */
@keyframes float {
    0%, 100% { transform: translateY(0) rotate(0deg); }
    50% { transform: translateY(-20px) rotate(180deg); }
}
  
  
        @media (max-width: 1024px) {
            .mobile-warning {
                display: flex;
            }
            .container {
                display: none;
            }
        }

        .custom-cursor {
            position: fixed;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, var(--primary-color) 20%, transparent 80%);
            border-radius: 50%;
            pointer-events: none;
            z-index: 9999;
            transition: transform 0.1s ease;
        }

        .custom-cursor.hover {
            transform: scale(1.5);
            background: radial-gradient(circle, var(--primary-hover) 20%, transparent 80%);
        }

        .particle-bg {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: -1;
}
 
    .particle {
    position: absolute;
    width: 3px; /* Smaller size for a star-like point */
    height: 3px; /* Smaller size for a star-like point */
    background: radial-gradient(circle, rgba(255, 255, 255, 0.8) 20%, rgba(0, 102, 102, 0.3) 70%); /* White center with teal glow */
    border-radius: 50%;
    animation: starDrift 20s infinite linear; /* Longer duration for smooth drift */
    pointer-events: none;
    box-shadow: 0 0 5px rgba(255, 255, 255, 0.5); /* Subtle glow for star effect */
}
    
    @keyframes starDrift {
    0% {
        transform: translate(0, 0) scale(1);
        opacity: 0.3 + Math.random() * 0.5; /* Random initial opacity for twinkling */
    }
    25% {
        transform: translate(-50px, -100px) scale(1.2); /* Drift left and up */
        opacity: 0.6 + Math.random() * 0.3;
    }
    50% {
        transform: translate(50px, -200px) scale(1); /* Drift right and further up */
        opacity: 0.4 + Math.random() * 0.4;
    }
    75% {
        transform: translate(0, -100px) scale(1.1); /* Return slightly */
        opacity: 0.5 + Math.random() * 0.3;
    }
    100% {
        transform: translate(0, 0) scale(1);
        opacity: 0.3 + Math.random() * 0.5;
    }
}
    


        .container {
            display: flex;
            min-height: 100vh;
            position: relative;
        }

        .sidebar {
            width: 250px;
            background: var(--sidebar-bg);
            height: 100vh;
            position: fixed;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            z-index: 10;
            transition: transform 0.5s ease;
        }

        .sidebar:hover {
            transform: translateX(10px);
        }

        .sidebar h2 {
            text-align: center;
            padding: 20px 0;
            font-size: 28px;
            font-weight: 700;
            letter-spacing: 2px;
            border-bottom: 1px solid var(--border-color);
            color: var(--primary-color);
            text-shadow: 0 0 10px var(--neon-glow);
            animation: neonPulse 2s infinite;
        }

        @keyframes neonPulse {
            0%, 100% { text-shadow: 0 0 5px var(--neon-glow); }
            50% { text-shadow: 0 0 15px var(--neon-glow); }
        }

        .sidebar nav {
            flex: 1;
            padding: 20px 0;
        }

        .sidebar a {
            display: block;
            padding: 15px 20px;
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 500;
            position: relative;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .sidebar a::before {
            content: '';
            position: absolute;
            left: -100%;
            top: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(120deg, transparent, rgba(154, 140, 126, 0.3), transparent);
            transition: left 0.5s ease;
        }

        .sidebar a:hover::before, .sidebar a.active::before {
            left: 100%;
        }

        .sidebar a:hover, .sidebar a.active {
    color: #FFFFFF;
    background: rgba(0, 102, 102, 0.2); /* Semi-transparent teal */
    border-left: 5px solid #006666; /* Teal border */
    padding-left: 15px;
    box-shadow: 0 0 10px #006666; /* Teal glow */
}

        .dropdown-content {
            display: none;
            background: rgba(0, 0, 0, 0.2);
            transition: max-height 0.5s ease;
            max-height: 0;
        }

        .dropdown:hover .dropdown-content, .dropdown.active .dropdown-content {
            display: block;
            max-height: 500px;
        }

        .dropdown-content a {
            padding-left: 35px;
            font-size: 14px;
        }

        .dropdown-toggle::after {
            content: 'â–¼';
            position: absolute;
            right: 20px;
            font-size: 12px;
            top: 50%;
            transform: translateY(-50%) rotate(0deg);
            transition: transform 0.3s ease;
        }

        .dropdown:hover .dropdown-toggle::after, .dropdown.active .dropdown-toggle::after {
            transform: translateY(-50%) rotate(180deg);
        }

        .bottom-links {
            padding: 20px 0;
            border-top: 1px solid var(--border-color);
        }

        .main-content {
            flex: 1;
            margin-left: 250px;
            padding: 30px;
            min-height: 100vh;
            overflow-y: auto;
            opacity: 0;
            animation: fadeIn 1s forwards;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            position: relative;
            transform: translateY(-20px);
            animation: slideDown 0.5s ease forwards;
        }

        @keyframes slideDown {
            to { transform: translateY(0); }
        }

        .welcome-message {
            font-size: 18px;
            color: var(--text-secondary);
            text-shadow: 0 0 5px var(--primary-color);
        }

        .search-bar {
            flex: 1;
            max-width: 400px;
            padding: 12px 20px;
            border: 1px solid var(--border-color);
            border-radius: 25px;
            background: rgba(0, 0, 0, 0.2);
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .search-bar:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 10px var(--primary-color);
            outline: none;
            animation: pulseBorder 1s infinite;
        }

        @keyframes pulseBorder {
            0%, 100% { box-shadow: 0 0 5px var(--primary-color); }
            50% { box-shadow: 0 0 15px var(--primary-color); }
        }

        .icons {
            display: flex;
            gap: 25px;
            position: relative;
        }

        .bell, .user {
            font-size: 24px;
            cursor: pointer;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.2);
            position: relative;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            background-size: cover;
            background-position: center;
        }

        .bell:hover, .user:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px var(--primary-color);
        }

        .bell::before { content: '\F0132'; font-family: 'Material Design Icons'; }
        .user::before { content: '\F05E0'; font-family: 'Material Design Icons'; }

        .notification-dot {
    background: #A9B7C0; /* Soft silver-blue */
}

        @keyframes pulseDot {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .notification-panel {
            display: none;
            position: absolute;
            top: 60px;
            right: 0;
            background: var(--card-bg);
            color: var(--text-primary);
            padding: 15px;
            border-radius: 12px;
            width: 300px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            transform: translateY(-20px);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .notification-panel.active {
            display: block;
            transform: translateY(0);
            opacity: 1;
        }

        .notification-item {
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
            transition: background 0.3s ease;
        }

        .notification-item:hover {
            background: var(--table-row-hover);
        }

        .hidden { display: none !important; }

        .dashboard {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin-bottom: 30px;
        }

        .dashboard-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            flex: 1;
            min-width: 300px;
            transform: perspective(1000px) rotateY(5deg);
            transition: transform 0.5s ease;
        }

        .dashboard-card:hover {
            transform: perspective(1000px) rotateY(0deg);
        }

        .dashboard-card canvas {
            max-height: 250px;
        }

        .module { 
            display: none; 
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
        }

        .module.active { 
            display: block; 
            opacity: 1;
            transform: translateY(0);
        }

        .tab-container {
            display: flex;
            margin-bottom: 30px;
            background: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
        }

        .tab {
            padding: 15px 25px;
            cursor: pointer;
            font-weight: 700;
            flex: 1;
            text-align: center;
            color: var(--text-secondary);
            transition: all 0.3s ease;
            position: relative;
        }

        .tab::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 3px;
            background: var(--primary-color);
            transition: width 0.3s ease;
        }

        .tab:hover::after, .tab.active::after {
            width: 100%;
        }

        .tab.active {
            color: var(--primary-color);
            text-shadow: 0 0 5px var(--primary-color);
        }

        .table-container {
            display: none;
            background: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            overflow-x: auto;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            transform: scale(0.95);
            transition: all 0.5s ease;
        }

        .table-container.active { 
            display: block; 
            transform: scale(1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            color: var(--text-primary);
        }

        thead { 
            background: var(--table-header-bg); 
            position: sticky;
            top: 0;
            z-index: 5;
        }

        th, td { 
            padding: 15px 20px; 
            border-bottom: 1px solid var(--border-color); 
            transition: background 0.3s ease;
        }

        th {
            cursor: pointer;
            user-select: none;
        }

        th:hover {
            background: var(--primary-hover);
        }

        tbody tr:nth-child(even) { background: var(--table-row-even); }
        tbody tr:hover { background: var(--table-row-hover); }

        .buttons-container { 
            display: flex; 
            gap: 15px; 
            margin-bottom: 30px; 
            flex-wrap: wrap;
        }

        .action-btn, .edit-btn {
            padding: 12px 20px;
            background: var(--card-bg);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
.primary-btn {
    background: linear-gradient(to bottom, #006666, #004D4D);
    border: none;
    color: #FFFFFF;
    text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
}
  
        .action-btn:hover, .edit-btn:hover, .primary-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px var(--primary-color);
        }

        .edit-btn { padding: 8px 15px; }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal:not(.hidden) { 
            display: flex; 
            opacity: 1;
        }

        .modal-content {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 12px;
            width: 450px;
            color: var(--text-primary);
            transform: scale(0.8);
            animation: zoomIn 0.5s forwards;
        }

        @keyframes zoomIn {
            to { transform: scale(1); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            align-items: center;
        }

        .modal-header h3 {
            text-shadow: 0 0 5px var(--primary-color);
        }

        .close-modal {
            font-size: 24px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .close-modal:hover {
            transform: rotate(90deg);
        }

        .modal-body input, .modal-body textarea, .modal-body select {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .modal-body input:focus, .modal-body textarea:focus, .modal-body select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 10px var(--primary-color);
            outline: none;
        }

        .modal-footer {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
        }

        .profile-pic-display {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background-size: cover;
            background-position: center;
            margin: 0 auto 20px;
            border: 3px solid var(--primary-color);
            box-shadow: 0 0 15px var(--primary-color);
            transition: transform 0.3s ease;
        }

        .profile-pic-display:hover {
            transform: scale(1.05);
        }

        .status-tabs {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .status-tab {
            padding: 12px 25px;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 25px;
            cursor: pointer;
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .status-tab.active {
            background: var(--primary-color);
            color: #fff;
            box-shadow: 0 0 10px var(--primary-color);
        }

        .settings-container {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 12px;
            margin-top: 30px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        .settings-container label {
            display: block;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .pagination {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .past-disposals-list {
            margin-top: 15px;
            padding: 15px;
            background: var(--card-bg);
            border-radius: 12px;
            max-height: 350px;
            overflow-y: auto;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        .past-disposals-list div {
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
            transition: background 0.3s ease;
        }

        .past-disposals-list div:hover {
            background: var(--table-row-hover);
        }

        .sort-icon::after {
            content: 'â†•';
            margin-left: 5px;
            font-size: 12px;
        }

        .sort-icon.asc::after { content: 'â†‘'; }
    
    
    
    
     .sort-icon.desc::after { content: 'â†“'; }
    
    
/* ===== Full-width layout ===== */
.container {
    display: flex;
    min-height: 100vh;
    width: 100%;
    margin: 0;
    padding: 0;
}

.main-content {
    flex: 1;
    margin-left: 250px; /* Sidebar width */
    padding: 30px;
    min-height: 100vh;
    overflow-y: auto;
    background: var(--main-bg);
    width: calc(100% - 250px); /* Full width minus sidebar */
}

/* ===== Professional header ===== */
.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    background: var(--card-bg);
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
}

/* ===== Improved search bar ===== */
.search-bar {
    flex: 1;
    max-width: 500px;
    padding: 12px 20px;
    border: 1px solid var(--border-color);
    border-radius: 25px;
    background: rgba(0, 0, 0, 0.1);
    color: var(--text-primary);
    font-size: 14px;
    transition: all 0.3s ease;
}

.search-bar:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 10px var(--primary-color);
    outline: none;
}

/* ===== Professional table styling ===== */
.table-container {
    background: var(--card-bg);
    border-radius: 12px;
    padding: 25px;
    overflow-x: auto;
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
}

table {
    width: 100%;
    border-collapse: collapse;
    color: var(--text-primary);
}

th, td {
    padding: 15px 20px;
    border-bottom: 1px solid var(--border-color);
    text-align: left;
}

th {
    background: var(--table-header-bg);
    font-weight: 700;
}

tbody tr:hover {
    background: var(--table-row-hover);
}

/* ===== Notification panel improvements ===== */
.notification-panel {
    position: absolute;
    top: 60px;
    right: 0;
    background: var(--card-bg);
    color: var(--text-primary);
    padding: 15px;
    border-radius: 12px;
    width: 350px;
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
    z-index: 1000;
    transform: translateY(-20px);
    opacity: 0;
    transition: all 0.3s ease;
}

.notification-panel.active {
    display: block;
    transform: translateY(0);
    opacity: 1;
}

.notification-item {
    padding: 10px;
    border-bottom: 1px solid var(--border-color);
    transition: background 0.3s ease;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.notification-item:hover {
    background: var(--table-row-hover);
}

.notification-item .delete-notification {
    color: var(--danger-color);
    cursor: pointer;
    font-size: 16px;
    margin-left: 10px;
}

.notification-item .delete-notification:hover {
    color: var(--primary-hover);
}

.clear-all-btn {
    background: var(--danger-color);
    color: #fff;
    border: none;
    padding: 8px 15px;
    border-radius: 5px;
    cursor: pointer;
    font-family: 'Orbitron', sans-serif;
    margin-bottom: 10px;
}

.clear-all-btn:hover {
    background: var(--primary-hover);
}

/* ===== Holographic card improvements ===== */
.holographic-display {
    position: relative;
    background: rgba(0, 102, 102, 0.1);
    border-radius: 20px;
    padding: 20px;
    margin-bottom: 30px;
    overflow: hidden;
    border: 2px solid #00ffff;
    box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
    backdrop-filter: blur(10px);
}

.hologram-card {
    background: rgba(0, 102, 102, 0.2);
    border: 1px solid #00ffff;
    border-radius: 10px;
    padding: 15px;
    margin: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
    z-index: 1;
}

.hologram-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 0 20px rgba(0, 255, 255, 0.4);
}
    
    
    /* ===== Disposal Dashboard Styles ===== */
#disposalDashboard {
    padding: 20px;
    background: var(--card-bg);
    border-radius: 12px;
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    margin-bottom: 30px;
    position: relative;
    overflow: hidden;
}

.holographic-display {
    position: relative;
    background: rgba(0, 102, 102, 0.1);
    border-radius: 20px;
    padding: 20px;
    margin-bottom: 30px;
    overflow: hidden;
    border: 2px solid #00ffff;
    box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
    backdrop-filter: blur(10px);
}

.particle-container {
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    pointer-events: none;
    z-index: 0;
}

.hologram-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.hologram-card {
    background: rgba(0, 102, 102, 0.2);
    border: 1px solid #00ffff;
    border-radius: 10px;
    padding: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
    z-index: 1;
}

.hologram-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 0 20px rgba(0, 255, 255, 0.4);
}

.hologram-card h4 {
    font-size: 18px;
    margin-bottom: 10px;
    color: var(--text-primary);
}

.hologram-card p {
    font-size: 14px;
    color: var(--text-secondary);
    margin: 5px 0;
}

.hologram-card .status-pending {
    color: var(--warning-color);
}

.hologram-card .status-approved {
    color: var(--success-color);
}

.hologram-card .status-rejected {
    color: var(--danger-color);
}

.view-form-btn {
    background: linear-gradient(45deg, #006666, #00ffff);
    border: none;
    padding: 8px 15px;
    border-radius: 5px;
    cursor: pointer;
    margin-top: 10px;
    font-family: 'Orbitron', sans-serif;
    color: #fff;
    text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
    transition: all 0.3s ease;
}

.view-form-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
}

/* Add particle animation */
@keyframes float {
    0%, 100% { transform: translateY(0) rotate(0deg); }
    50% { transform: translateY(-20px) rotate(180deg); }
}
    
    </style>
</head>
<body data-theme="dark">
    <div class="mobile-warning">
        <div>
            <h2>Desktop Only</h2>
            <p>This website is designed for desktop use only. Please access it on a laptop or desktop browser for the best experience.</p>
        </div>
    </div>
    <div class="custom-cursor" id="cursor"></div>
    <div class="particle-bg" id="particleBg"></div>
    <div class="container">
        <aside class="sidebar">
            <h2 ondblclick="showEasterEgg()">DAMS</h2>
            <nav>
                <a href="#" data-module="inventory">Inventory</a>
                <div class="dropdown">
                    <a href="#" class="dropdown-toggle" data-default-module="maintenance">Maintenance</a>
                    <div class="dropdown-content">
                        <a href="#" data-module="maintenance">Maintenance Records</a>
                        <a href="#" data-module="student-issues">Student Issues</a>
                    </div>
                </div>
               <div class="dropdown">
    <a href="#" class="dropdown-toggle" data-default-module="disposal">Disposal</a>
    <div class="dropdown-content">
        <a href="#" data-module="disposal">Disposal (Assistant)</a>
        <a href="#" data-module="disposal-faculty">Disposal (Faculty)</a>
        <a href="#" data-module="disposal-stores">Disposal (Stores)</a>
    </div>
</div>
            </nav>
            <div class="bottom-links">
                <a href="#" data-module="settings">Settings</a>
                <a href="#" data-module="logout">Log Out</a>
            </div>
        </aside>

        <main class="main-content">
            <div class="header">
                <span class="welcome-message" id="welcomeMessage">Welcome!</span>
                <input type="text" class="search-bar" placeholder="Search..." id="searchInput">
                <div class="icons">
                    <span class="bell" id="notificationBell">
                        <span id="notificationDot" class="notification-dot hidden"></span>
                    </span>
                    <span class="user" id="profileIcon"></span>
                </div>
            </div>

            <div id="inventory" class="module">
                <div class="buttons-container">
                    <button class="action-btn primary-btn" id="addInventoryBtn">Add Asset</button>
                    <select id="inventoryStatusFilter" class="action-btn">
                        <option value="">All Statuses</option>
                        <option value="Active">Active</option>
                        <option value="Inactive">Inactive</option>
                    </select>
                </div>
                <div class="table-container active">
                    <table>
                        <thead>
                            <tr>
                                <th class="sort-icon" data-sort="id">Asset ID</th>
                                <th class="sort-icon" data-sort="name">Asset Name</th>
                                <th class="sort-icon" data-sort="category">Category</th>
                                <th class="sort-icon" data-sort="status">Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="inventoryTableBody"></tbody>
                    </table>
                    <div class="pagination">
                        <button class="action-btn" id="inventoryPrev">Previous</button>
                        <span id="inventoryPageInfo"></span>
                        <button class="action-btn" id="inventoryNext">Next</button>
                    </div>
                </div>
            </div>

            <div id="maintenance" class="module">
                <div class="dashboard">
                    <div class="dashboard-card">
                        <h3>Total Items vs Alerts</h3>
                        <canvas id="maintenanceOverviewChart"></canvas>
                    </div>
                </div>
                <div class="tab-container">
                    <div class="tab active" id="showMaintenanceRecords" data-target="maintenanceRecordsTable">Maintenance Records</div>
                    <div class="tab" id="showAlerts" data-target="alertsTable">Alerts</div>
                </div>
                <div id="maintenanceRecordsTable" class="table-container active">
                    <div class="buttons-container">
                        <button class="action-btn primary-btn" id="addMaintenanceBtn">Add Item</button>
                        <button class="action-btn primary-btn" id="disposalBtn">Send Disposal Request</button>
                        <select id="maintenanceLabFilter" class="action-btn">
                            <option value="">All Labs</option>
                            <option value="Networking Lab">Networking Lab</option>
                            <option value="AI Lab">AI Lab</option>
                            <option value="DS Lab">DS Lab</option>
                            <option value="ML Lab">ML Lab</option>
                            <option value="Funds Lab">Funds Lab</option>
                        </select>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="selectAllMaintenance"></th>
                                <th class="sort-icon" data-sort="id">S.No.</th>
                                <th class="sort-icon" data-sort="labName">Lab Name</th>
                                <th class="sort-icon" data-sort="productName">Product Name</th>
                                <th class="sort-icon" data-sort="purchaseDate">Purchase Date</th>
                                <th class="sort-icon" data-sort="serviceProvider">Service Provider</th>
                                <th class="sort-icon" data-sort="dueDate">Due Date</th>
                                <th class="sort-icon" data-sort="lastMaintenance">Last Maintenance</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="maintenanceTableBody"></tbody>
                    </table>
                    <div class="pagination">
                        <button class="action-btn" id="maintenancePrev">Previous</button>
                        <span id="maintenancePageInfo"></span>
                        <button class="action-btn" id="maintenanceNext">Next</button>
                    </div>
                </div>
                <div id="alertsTable" class="table-container">
                    <div class="buttons-container">
                        <button class="action-btn primary-btn" id="updateRecordsBtn">Update Records</button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="selectAllAlertsCheckbox"></th>
                                <th class="sort-icon" data-sort="productName">Product Name</th>
                                <th class="sort-icon" data-sort="purchaseDate">Purchase Date</th>
                                <th class="sort-icon" data-sort="lastMaintenance">Last Maintenance</th>
                                <th class="sort-icon" data-sort="dueDate">Due Date</th>
                                <th>Check</th>
                            </tr>
                        </thead>
                        <tbody id="alertsTableBody"></tbody>
                    </table>
                    <div class="pagination">
                        <button class="action-btn" id="alertsPrev">Previous</button>
                        <span id="alertsPageInfo"></span>
                        <button class="action-btn" id="alertsNext">Next</button>
                    </div>
                </div>
            </div>

            <div id="student-issues" class="module">
                <div class="dashboard">
                    <div class="dashboard-card">
                        <h3>Total Issues: Pending vs Resolved</h3>
                        <canvas id="studentIssuesChart"></canvas>
                    </div>
                </div>
                <div class="buttons-container">
                    <button class="action-btn primary-btn" id="addIssueBtn">Add Issue</button>
                </div>
                <div class="table-container active">
                    <table>
                        <thead>
                            <tr>
                                <th class="sort-icon" data-sort="id">Issue ID</th>
                                <th class="sort-icon" data-sort="studentName">Student Name</th>
                                <th class="sort-icon" data-sort="lab">Lab</th>
                                <th class="sort-icon" data-sort="issue">Issue</th>
                                <th class="sort-icon" data-sort="status">Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="studentIssuesTable"></tbody>
                    </table>
                    <div class="pagination">
                        <button class="action-btn" id="studentIssuesPrev">Previous</button>
                        <span id="studentIssuesPageInfo"></span>
                        <button class="action-btn" id="studentIssuesNext">Next</button>
                    </div>
                    <div class="status-tabs">
                        <button class="status-tab active" id="showPending">Pending</button>
                        <button class="status-tab" id="showResolved">Resolved</button>
                    </div>
                </div>
            </div>
<div id="disposal" class="module">
    <div class="dashboard" id="disposalDashboard">
        <div class="holographic-display">
            <div class="particle-container"></div>
            <div class="notification-overlay">
                <h3>ðŸ”„ Active Condemnation Requests</h3>
                <button class="clear-all-btn" onclick="clearAllRequests()">Clear All Requests</button>
                <div class="hologram-cards" id="condemnationRequests">
                    <!-- Dynamically populated condemnation requests will appear here -->
                </div>
            </div>
        </div>
    </div>
    <div class="table-container active">
       <table id="disposalTable">
    <thead>
        <tr>
            <th></th>
            <th>ID</th>
            <th>Lab Name</th>
            <th>Product Name</th>
            <th>Purchase Date</th>
            <th>Service Provider</th>
            <th>Due Date</th>
            <th>Last Maintenance</th>
            <th>Reason</th>
            <th>Status</th>
            <th>Forms</th> <!-- Updated to "Forms" -->
        </tr>
    </thead>
    <tbody id="disposalTableBody"></tbody>
</table> 
        <div class="pagination">
            <button class="action-btn" id="disposalPrev">Previous</button>
            <span id="disposalPageInfo"></span>
            <button class="action-btn" id="disposalNext">Next</button>
        </div>
    </div>
    <button class="action-btn" id="showPastDisposals">Past Disposals</button>
    <div id="pastDisposalsList" class="past-disposals-list hidden"></div>
    <div class="pagination" id="pastDisposalsPagination">
        <button class="action-btn" id="pastDisposalsPrev">Previous</button>
        <span id="pastDisposalsPageInfo"></span>
        <button class="action-btn" id="pastDisposalsNext">Next</button>
    </div>
</div>
            <div id="disposal-faculty" class="module">
                <div class="buttons-container">
                    <button class="action-btn primary-btn" id="approveDisposalFaculty">Approve Selected</button>
                    <button class="action-btn primary-btn" id="rejectDisposalFaculty">Reject Selected</button>
                </div>
                <div class="table-container active">
                   <table id="disposalFacultyTable">
    <thead>
        <tr>
            <th></th>
            <th>ID</th>
            <th>Lab Name</th>
            <th>Product Name</th>
            <th>Purchase Date</th>
            <th>Service Provider</th>
            <th>Due Date</th>
            <th>Last Maintenance</th>
            <th>Reason</th>
            <th>Status</th>
            <th>Forms</th> <!-- Updated to "Forms" -->
            <th>Actions</th>
        </tr>
    </thead>
    <tbody id="disposalFacultyTableBody"></tbody>
</table>
                    <div class="pagination">
                        <button class="action-btn" id="disposalFacultyPrev">Previous</button>
                        <span id="disposalFacultyPageInfo"></span>
                        <button class="action-btn" id="disposalFacultyNext">Next</button>
                    </div>
                </div>
                <button class="action-btn" id="showPastDisposalsFaculty">Past Disposals</button>
                <div id="pastDisposalsListFaculty" class="past-disposals-list hidden"></div>
                <div class="pagination" id="pastDisposalFacultyPagination">
                    <button class="action-btn" id="pastDisposalsFacultyPrev">Previous</button>
                    <span id="pastDisposalsFacultyPageInfo"></span>
                    <button class="action-btn" id="pastDisposalsFacultyNext">Next</button>
                </div>
            </div>

          
<div id="disposal-stores" class="module">
    <div class="dashboard" id="disposalStoresDashboard">
        <div class="holographic-display">
            <div class="particle-container"></div>
            <div class="notification-overlay">
                <h3>ðŸ”„ Active Condemnation Requests</h3>
                <button class="clear-all-btn" onclick="clearAllRequests()">Clear All Requests</button>
                <div class="hologram-cards" id="condemnationRequestsStores">
                    <!-- Dynamically populated condemnation requests will appear here -->
                </div>
            </div>
        </div>
    </div>
    <div class="table-container active">
        <table id="disposalStoresTable">
    <thead>
        <tr>
            <th></th>
            <th>ID</th>
            <th>Lab Name</th>
            <th>Product Name</th>
            <th>Purchase Date</th>
            <th>Service Provider</th>
            <th>Due Date</th>
            <th>Last Maintenance</th>
            <th>Reason</th>
            <th>Status</th>
            <th>Forms</th> <!-- Updated to "Forms" -->
            <th>Actions</th>
        </tr>
    </thead>
    <tbody id="disposalStoresTableBody"></tbody>
</table>
        <div class="pagination">
            <button class="action-btn" id="disposalStoresPrev">Previous</button>
            <span id="disposalStoresPageInfo"></span>
            <button class="action-btn" id="disposalStoresNext">Next</button>
        </div>
    </div>
    <button class="action-btn" id="showPastDisposalsStores">Past Disposals</button>
    <div id="pastDisposalsListStores" class="past-disposals-list hidden"></div>
    <div class="pagination" id="pastDisposalsStoresPagination">
        <button class="action-btn" id="pastDisposalsStoresPrev">Previous</button>
        <span id="pastDisposalsStoresPageInfo"></span>
        <button class="action-btn" id="pastDisposalsStoresNext">Next</button>
    </div>
</div>
          
            <div id="settings" class="module">
                <h3>Settings</h3>
                <div class="settings-container">
                    <label>Theme:</label>
                    <select id="themeSelect">
                        <option value="dark">Dark</option>
                        <option value="light">Light</option>
                    </select>
                    <label><input type="checkbox" id="enableNotifications" checked> Enable Notifications</label>
                    <label><input type="checkbox" id="notificationSound"> Notification Sound</label>
                    <label>Rows Per Page:</label>
                    <select id="rowsPerPage">
                        <option value="5">5</option>
                        <option value="10" selected>10</option>
                        <option value="20">20</option>
                    </select>
                    <label>Language:</label>
                    <select id="languageSelect">
                        <option value="en">English</option>
                        <option value="es">Spanish (Placeholder)</option>
                    </select>
                    <button class="action-btn" id="resetProfile">Reset Profile</button>
                    <button class="action-btn" id="clearData">Clear All Data</button>
                </div>
            </div>

            <div id="logout" class="module">
                <h3>Logging Out...</h3>
                <p>You will be logged out in <span id="logoutTimer">5</span> seconds.</p>
            </div>
        </main>
    </div>

    <div id="addInventoryModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Asset</h3>
                <span class="close-modal">Ã—</span>
            </div>
            <div class="modal-body">
                <label>Asset ID:</label><input type="text" id="newAssetId">
                <label>Asset Name:</label><input type="text" id="newAssetName">
                <label>Category:</label><input type="text" id="newAssetCategory">
                <label>Status:</label><select id="newAssetStatus">
                    <option value="Active">Active</option>
                    <option value="Inactive">Inactive</option>
                </select>
            </div>
            <div class="modal-footer">
                <button class="action-btn" id="cancelAddInventory">Cancel</button>
                <button class="action-btn primary-btn" id="saveAddInventory">Save</button>
            </div>
        </div>
    </div>

    <div id="addMaintenanceModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Maintenance Item</h3>
                <span class="close-modal">Ã—</span>
            </div>
            <div class="modal-body">
                <label>S.No.:</label><input type="number" id="newMaintenanceId">
                <label>Lab Name:</label><input type="text" id="newMaintenanceLabName">
                <label>Product Name:</label><input type="text" id="newMaintenanceProductName">
                <label>Purchase Date:</label><input type="date" id="newMaintenancePurchaseDate">
                <label>Service Provider:</label><input type="text" id="newMaintenanceServiceProvider">
                <label>Due Date:</label><input type="date" id="newMaintenanceDueDate">
                <label>Last Maintenance:</label><input type="date" id="newMaintenanceLastMaintenance">
            </div>
            <div class="modal-footer">
                <button class="action-btn" id="cancelAddMaintenance">Cancel</button>
                <button class="action-btn primary-btn" id="saveAddMaintenance">Save</button>
            </div>
        </div>
    </div>

    <div id="updateMaintenanceModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Update Maintenance Record</h3>
                <span class="close-modal">Ã—</span>
            </div>
            <div class="modal-body">
                <input type="hidden" id="maintenanceId">
                <label>Last Maintenance Date:</label>
                <input type="date" id="lastMaintenanceDate">
            </div>
            <div class="modal-footer">
                <button class="action-btn" id="cancelMaintenanceUpdate">Cancel</button>
                <button class="action-btn primary-btn" id="saveMaintenanceUpdate">Save</button>
            </div>
        </div>
    </div>

    <div id="disposalRequestModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Send Disposal Request</h3>
                <span class="close-modal">Ã—</span>
            </div>
            <div class="modal-body">
                <label>Reason for Disposal:</label>
                <textarea id="disposalReason" rows="4"></textarea>
            </div>
            <div class="modal-footer">
                <button class="action-btn" id="cancelDisposalRequest">Cancel</button>
                <button class="action-btn primary-btn" id="sendDisposalRequest">Send</button>
            </div>
        </div>
    </div>

    <div id="updateIssueModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="issueModalTitle">Add New Issue</h3>
                <span class="close-modal">Ã—</span>
            </div>
            <div class="modal-body">
                <input type="hidden" id="issueId">
                <label>Student Name:</label><input type="text" id="studentName">
                <label>Lab:</label><select id="issueLab">
                    <option value="Ip">Ip</option>
                    <option value="Funds">Funds</option>
                    <option value="Mpmc">Mpmc</option>
                    <option value="DS">DS</option>
                    <option value="AI">AI</option>
                    <option value="ML">ML</option>
                </select>
                <label>Issue Details:</label><textarea id="issueDetails" rows="3"></textarea>
                <label>Status:</label><select id="issueStatus">
                    <option value="Pending">Pending</option>
                    <option value="Resolved">Resolved</option>
                </select>
            </div>
            <div class="modal-footer">
                <button class="action-btn" id="discardIssueChanges">Discard</button>
                <button class="action-btn primary-btn" id="updateIssueBtn">Update</button>
            </div>
        </div>
    </div>

    <div id="updateDisposalModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Update Disposal Status</h3>
                <span class="close-modal">Ã—</span>
            </div>
            <div class="modal-body">
                <input type="hidden" id="disposalId">
                <label>Status:</label><select id="disposalStatus">
                    <option value="Pending">Pending</option>
                    <option value="In Review">In Review</option>
                    <option value="Approved">Approved</option>
                    <option value="Rejected">Rejected</option>
                    <option value="Approved, Disposed">Approved, Disposed</option>
                </select>
            </div>
            <div class="modal-footer">
                <button class="action-btn" id="cancelDisposalUpdate">Cancel</button>
                <button class="action-btn primary-btn" id="updateDisposalStatus">Update</button>
            </div>
        </div>
    </div>

    <div id="profileModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="profileModalTitle">User Profile</h3>
                <span class="close-modal">Ã—</span>
            </div>
            <div class="modal-body" id="profileModalBody"></div>
            <div class="modal-footer" id="profileModalFooter"></div>
        </div>
    </div>

    <div id="notificationPanel" class="notification-panel hidden">
        <button class="action-btn primary-btn" id="markAsRead">Mark as Read</button>
        <div id="notificationList"></div>
    </div>

   <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
<script>
    const modules = document.querySelectorAll('.module');
    const sidebarLinks = document.querySelectorAll('.sidebar a');
    const tabs = document.querySelectorAll('.tab');
    const searchInput = document.getElementById('searchInput');
    const notificationBell = document.getElementById('notificationBell');
    const notificationDot = document.getElementById('notificationDot');
    const notificationPanel = document.getElementById('notificationPanel');
    const notificationList = document.getElementById('notificationList');
    const markAsReadBtn = document.getElementById('markAsRead');
    const profileIcon = document.getElementById('profileIcon');
    const maintenanceTableBody = document.getElementById('maintenanceTableBody');
    const alertsTableBody = document.getElementById('alertsTableBody');
    const studentIssuesTable = document.getElementById('studentIssuesTable');
    const disposalTableBody = document.getElementById('disposalTableBody');
    const disposalFacultyTableBody = document.getElementById('disposalFacultyTableBody');
    const disposalStoresTableBody = document.getElementById('disposalStoresTableBody');
    const inventoryTableBody = document.getElementById('inventoryTableBody');
    const disposalBtn = document.getElementById('disposalBtn');
    const updateRecordsBtn = document.getElementById('updateRecordsBtn');
    const addIssueBtn = document.getElementById('addIssueBtn');
    const addInventoryBtn = document.getElementById('addInventoryBtn');
    const addMaintenanceBtn = document.getElementById('addMaintenanceBtn');
    const rejectDisposalFaculty = document.getElementById('rejectDisposalFaculty');
    const approveDisposalFaculty = document.getElementById('approveDisposalFaculty');
    const updateMaintenanceModal = document.getElementById('updateMaintenanceModal');
    const disposalRequestModal = document.getElementById('disposalRequestModal');
    const updateIssueModal = document.getElementById('updateIssueModal');
    const updateDisposalModal = document.getElementById('updateDisposalModal');
    const profileModal = document.getElementById('profileModal');
    const addInventoryModal = document.getElementById('addInventoryModal');
    const addMaintenanceModal = document.getElementById('addMaintenanceModal');
    const showPendingBtn = document.getElementById('showPending');
    const showResolvedBtn = document.getElementById('showResolved');
    const showPastDisposalsBtn = document.getElementById('showPastDisposals');
    const showPastDisposalsFacultyBtn = document.getElementById('showPastDisposalsFaculty');
    const showPastDisposalsStoresBtn = document.getElementById('showPastDisposalsStores');
    const inventoryStatusFilter = document.getElementById('inventoryStatusFilter');
    const maintenanceLabFilter = document.getElementById('maintenanceLabFilter');
    const welcomeMessage = document.getElementById('welcomeMessage');
    const cursor = document.getElementById('cursor');
    const particleBg = document.getElementById('particleBg');

    let maintenanceData = JSON.parse(localStorage.getItem('maintenanceData')) || [
        { id: 101, labName: "Networking Lab", productName: "Router Cisco", purchaseDate: "2020-05-10", serviceProvider: "NetTech", dueDate: "2025-05-10", lastMaintenance: "-", disposalPending: false },
        { id: 102, labName: "AI Lab", productName: "GPU Nvidia", purchaseDate: "2021-06-15", serviceProvider: "AI Solutions", dueDate: "2025-06-15", lastMaintenance: "2024-02-01", disposalPending: false },
        { id: 103, labName: "DS Lab", productName: "Server Dell", purchaseDate: "2019-08-20", serviceProvider: "ServerCo", dueDate: "2025-08-20", lastMaintenance: "-", disposalPending: false },
        { id: 104, labName: "ML Lab", productName: "Workstation HP", purchaseDate: "2022-03-01", serviceProvider: "TechFix", dueDate: "2025-03-01", lastMaintenance: "2024-01-15", disposalPending: false },
        { id: 105, labName: "Funds Lab", productName: "Monitor LG", purchaseDate: "2020-11-10", serviceProvider: "MonitorMasters", dueDate: "2025-11-10", lastMaintenance: "-", disposalPending: false }
    ];
    localStorage.setItem('maintenanceData', JSON.stringify(maintenanceData));

    let studentIssuesData = JSON.parse(localStorage.getItem('studentIssuesData')) || [
        { id: 301, studentName: "Alice Carter", lab: "Networking Lab", issue: "Internet not working", status: "Pending" },
        { id: 302, studentName: "Bob Wilson", lab: "AI Lab", issue: "Software license expired", status: "Pending" },
        { id: 303, studentName: "Clara Evans", lab: "DS Lab", issue: "Mouse not responding", status: "Resolved" },
        { id: 304, studentName: "David Lee", lab: "ML Lab", issue: "Keyboard keys stuck", status: "Pending" },
        { id: 305, studentName: "Emma Davis", lab: "Funds Lab", issue: "Monitor flickering", status: "Resolved" }
    ];
    localStorage.setItem('studentIssuesData', JSON.stringify(studentIssuesData));

    let disposalData = JSON.parse(localStorage.getItem('disposalData')) || [
        { id: 101, labName: "Networking Lab", productName: "Router Cisco", purchaseDate: "2020-05-10", serviceProvider: "NetTech", dueDate: "2025-05-10", lastMaintenance: "-", reason: "Outdated", status: "pending_assistant", formRequestId: "REQ001" }
    ];
    localStorage.setItem('disposalData', JSON.stringify(disposalData));

    let pastDisposalsData = JSON.parse(localStorage.getItem('pastDisposalsData')) || [];
    localStorage.setItem('pastDisposalsData', JSON.stringify(pastDisposalsData));

    let inventoryData = JSON.parse(localStorage.getItem('inventoryData')) || [
        { id: "INV001", name: "Laptop Dell XPS", category: "Electronics", status: "Active" },
        { id: "INV002", name: "HP LaserJet Printer", category: "Electronics", status: "Inactive" },
        { id: "INV003", name: "Wooden Desk", category: "Furniture", status: "Active" },
        { id: "INV004", name: "Projector Epson", category: "Electronics", status: "Active" },
        { id: "INV005", name: "Ergonomic Chair", category: "Furniture", status: "Inactive" }
    ];
    localStorage.setItem('inventoryData', JSON.stringify(inventoryData));

    let alertsData = JSON.parse(localStorage.getItem('alertsData')) || [];
    localStorage.setItem('alertsData', JSON.stringify(alertsData));

    let notifications = JSON.parse(localStorage.getItem('notifications')) || [];
    localStorage.setItem('notifications', JSON.stringify(notifications));

    if (!localStorage.getItem('condemnationForms')) {
        const sampleForms = [
            { requestId: "REQ001", status: "pending_assistant", items: [{ id: 101, name: "Router Cisco" }] }
        ];
        localStorage.setItem('condemnationForms', JSON.stringify(sampleForms));
    }

    const today = new Date('2025-03-31'); // Match your specified date
    let currentFilter = 'all';
    let rowsPerPage = 10;
    let pagination = {
        inventory: 1,
        maintenance: 1,
        alerts: 1,
        studentIssues: 1,
        disposal: 1,
        disposalFaculty: 1,
        disposalStores: 1,
        pastDisposals: 1,
        pastDisposalsFaculty: 1,
        pastDisposalsStores: 1
    };
    let maintenanceChart, studentIssuesChart;
    let sortState = {};

    function init() {
        setActiveModule('inventory');
        populateAllTables();
        checkAlerts();
        initCharts();
        loadProfile();
        updateWelcomeMessage();
        initParticles();
        initDisposalModule();
    }

    function initParticles() {
        const particleCount = 150;
        for (let i = 0; i < particleCount; i++) {
            const particle = document.createElement('div');
            particle.classList.add('particle');
            particle.style.left = `${Math.random() * 100}%`;
            particle.style.top = `${Math.random() * 100}%`;
            particle.style.animationDuration = `${15 + Math.random() * 10}s`;
            particle.style.animationDelay = `${Math.random() * 5}s`;
            particle.style.animationDirection = Math.random() > 0.5 ? 'normal' : 'reverse';
            particleBg.appendChild(particle);
        }
    }

    document.addEventListener('mousemove', (e) => {
        cursor.style.left = `${e.clientX}px`;
        cursor.style.top = `${e.clientY}px`;
    });

    document.querySelectorAll('button, a, input, select, .bell, .user').forEach(el => {
        el.addEventListener('mouseenter', () => cursor.classList.add('hover'));
        el.addEventListener('mouseleave', () => cursor.classList.remove('hover'));
    });

    sidebarLinks.forEach(link => link.addEventListener('click', e => {
        e.preventDefault();
        setActiveModule(link.dataset.module || link.dataset.defaultModule);
    }));

    function setActiveModule(moduleId) {
        modules.forEach(m => m.classList.remove('active'));
        const activeModule = document.getElementById(moduleId);
        if (activeModule) activeModule.classList.add('active');
        sidebarLinks.forEach(l => l.classList.toggle('active', l.dataset.module === moduleId || l.dataset.defaultModule === moduleId));
        searchInput.placeholder = `Search ${moduleId.replace('-', ' ')}...`;
        updateCharts();
        if (moduleId === 'logout') startLogoutTimer();
    }

    function startLogoutTimer() {
        let timeLeft = 5;
        const timer = setInterval(() => {
            document.getElementById('logoutTimer').textContent = timeLeft;
            timeLeft--;
            if (timeLeft < 0) {
                clearInterval(timer);
                alert('Logged out!');
                setActiveModule('inventory');
            }
        }, 1000);
    }

    tabs.forEach(tab => tab.addEventListener('click', e => {
        tabs.forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.table-container').forEach(c => c.classList.remove('active'));
        e.target.classList.add('active');
        document.getElementById(e.target.dataset.target).classList.add('active');
        if (e.target.id === 'showAlerts') checkAlerts();
        populateAllTables();
    }));

    function paginate(data, page) {
        const start = (page - 1) * rowsPerPage;
        return data.slice(start, Math.min(start + rowsPerPage, data.length));
    }

    function updatePagination(tbodyId, dataLength, pageInfoId) {
        const totalPages = Math.ceil(dataLength / rowsPerPage) || 1;
        pagination[tbodyId] = Math.min(pagination[tbodyId], totalPages);
        const page = pagination[tbodyId];
        document.getElementById(`${tbodyId}Prev`).disabled = page === 1;
        document.getElementById(`${tbodyId}Next`).disabled = page === totalPages || dataLength === 0;
        document.getElementById(pageInfoId).textContent = `Page ${page} of ${totalPages}`;
    }

    function sortTable(data, key, tbodyId) {
        const direction = sortState[tbodyId]?.key === key && sortState[tbodyId]?.direction === 'asc' ? 'desc' : 'asc';
        sortState[tbodyId] = { key, direction };
        data.sort((a, b) => {
            const valA = a[key] || '';
            const valB = b[key] || '';
            return direction === 'asc' ? valA.localeCompare(valB) : valB.localeCompare(valA);
        });
        const th = document.querySelector(`#${tbodyId} th[data-sort="${key}"]`);
        th.classList.remove('asc', 'desc');
        th.classList.add(direction);
    }

    function populateMaintenanceTable() {
        maintenanceTableBody.innerHTML = '';
        let filteredData = maintenanceData;
        if (maintenanceLabFilter.value) {
            filteredData = maintenanceData.filter(item => item.labName === maintenanceLabFilter.value);
        }
        const items = paginate(filteredData, pagination.maintenance);
        items.forEach(item => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><input type="checkbox" data-id="${item.id}" ${item.disposalPending ? 'disabled' : ''}></td>
                <td title="Click to edit">${item.id}</td>
                <td title="Click to edit">${item.labName}</td>
                <td title="Click to edit">${item.productName}</td>
                <td title="Click to edit">${item.purchaseDate}</td>
                <td title="Click to edit">${item.serviceProvider}</td>
                <td title="Click to edit">${item.dueDate}</td>
                <td title="Click to edit">${item.lastMaintenance}</td>
                <td><button class="edit-btn" data-id="${item.id}" ${item.disposalPending ? 'disabled' : ''}>Edit</button></td>`;
            maintenanceTableBody.appendChild(row);
            row.querySelector('.edit-btn').addEventListener('click', openMaintenanceModal);
        });
        updatePagination('maintenance', filteredData.length, 'maintenancePageInfo');
        localStorage.setItem('maintenanceData', JSON.stringify(maintenanceData));
    }

    function populateAlertsTable() {
        alertsTableBody.innerHTML = '';
        const items = paginate(alertsData, pagination.alerts);
        items.forEach(item => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><input type="checkbox" data-id="${item.id}"></td>
                <td title="Go to maintenance">${item.productName}</td>
                <td title="Go to maintenance">${item.purchaseDate}</td>
                <td title="Go to maintenance">${item.lastMaintenance}</td>
                <td title="Go to maintenance">${item.dueDate}</td>
                <td><button class="action-btn" data-id="${item.id}">Check</button></td>`;
            alertsTableBody.appendChild(row);
            row.querySelector('.action-btn').addEventListener('click', () => {
                document.getElementById('showMaintenanceRecords').click();
                const row = Array.from(maintenanceTableBody.rows).find(r => r.cells[1].textContent == item.id);
                if (row) row.scrollIntoView({ behavior: 'smooth' });
            });
        });
        updatePagination('alerts', alertsData.length, 'alertsPageInfo');
        localStorage.setItem('alertsData', JSON.stringify(alertsData));
    }

    function renderCondemnationRequests() {
        const container = document.getElementById('condemnationRequests');
        const forms = JSON.parse(localStorage.getItem('condemnationForms') || '[]');
        container.innerHTML = forms.map(form => `
            <div class="hologram-card">
                <h4>Request #${form.requestId}</h4>
                <p>Status: <span class="${form.status.toLowerCase().replace(' ', '-')}-status">${form.status}</span></p>
                <p>Items: ${form.items.length}</p>
                <button class="view-form-btn" onclick="openCondemnationForm('${form.requestId}')">View Details</button>
                <span class="delete-btn" onclick="deleteRequest('${form.requestId}')">Ã—</span>
            </div>
        `).join('');
    }
function renderCondemnationRequestsStores() {
    const container = document.getElementById('condemnationRequestsStores');
    const forms = JSON.parse(localStorage.getItem('condemnationForms') || '[]');
    container.innerHTML = forms.map(form => `
        <div class="hologram-card">
            <h4>Request #${form.requestId}</h4>
            <p>Status: <span class="${form.status.toLowerCase().replace(' ', '-')}-status">${form.status}</span></p>
            <p>Items: ${form.items.length}</p>
            <button class="view-form-btn" onclick="openCondemnationForm('${form.requestId}')">View Details</button>
            <span class="delete-btn" onclick="deleteRequest('${form.requestId}')">Ã—</span>
        </div>
    `).join('');
}
    
    function deleteRequest(requestId) {
        const forms = JSON.parse(localStorage.getItem('condemnationForms') || '[]');
        const updatedForms = forms.filter(f => f.requestId !== requestId);
        localStorage.setItem('condemnationForms', JSON.stringify(updatedForms));
        renderCondemnationRequests();
        addNotification(`Condemnation request #${requestId} deleted.`);
    }

    function clearAllRequests() {
        if (confirm('Are you sure you want to clear all condemnation requests?')) {
            localStorage.removeItem('condemnationForms');
            renderCondemnationRequests();
            addNotification('All condemnation requests cleared.');
        }
    }

    function openCondemnationForm(requestId) {
        window.open(`condemnationFormsz.html?requestId=${requestId}`, '_blank');
    }

    function populateStudentIssuesTable() {
        studentIssuesTable.innerHTML = '';
        const filteredData = currentFilter === 'all' ? studentIssuesData : studentIssuesData.filter(item => item.status === currentFilter);
        const items = paginate(filteredData, pagination.studentIssues);
        items.forEach(item => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td title="Click to edit">${item.id}</td>
                <td title="Click to edit">${item.studentName}</td>
                <td title="Click to edit">${item.lab}</td>
                <td title="Click to edit">${item.issue}</td>
                <td title="Click to edit">${item.status}</td>
                <td><button class="edit-btn" data-id="${item.id}">Edit</button></td>`;
            studentIssuesTable.appendChild(row);
            row.querySelector('.edit-btn').addEventListener('click', openUpdateIssueModal);
        });
        updatePagination('studentIssues', filteredData.length, 'studentIssuesPageInfo');
        localStorage.setItem('studentIssuesData', JSON.stringify(studentIssuesData));
    }

    function populateInventoryTable() {
        inventoryTableBody.innerHTML = '';
        let filteredData = inventoryData;
        if (inventoryStatusFilter.value) {
            filteredData = inventoryData.filter(item => item.status === inventoryStatusFilter.value);
        }
        const items = paginate(filteredData, pagination.inventory);
        items.forEach(item => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td title="Click to edit">${item.id}</td>
                <td title="Click to edit">${item.name}</td>
                <td title="Click to edit">${item.category}</td>
                <td title="Click to edit">${item.status}</td>
                <td><button class="edit-btn" data-id="${item.id}">Edit</button></td>`;
            inventoryTableBody.appendChild(row);
        });
        updatePagination('inventory', filteredData.length, 'inventoryPageInfo');
        localStorage.setItem('inventoryData', JSON.stringify(inventoryData));
    }
function populateDisposalTables() {
    let disposalData = JSON.parse(localStorage.getItem('disposalData') || '[]');

    // Common function to populate any table body
    const populateTable = (tableBody, paginationType, pageInfoId) => {
        tableBody.innerHTML = '';
        const items = paginate(disposalData, pagination[paginationType]);
        items.forEach(item => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><input type="checkbox" data-id="${item.id}"></td>
                <td>${item.id}</td>
                <td>${item.labName}</td>
                <td>${item.productName}</td>
                <td>${item.purchaseDate}</td>
                <td>${item.serviceProvider}</td>
                <td>${item.dueDate}</td>
                <td>${item.lastMaintenance}</td>
                <td>${item.reason || 'N/A'}</td>
                <td>${item.status}</td>
                <td>${item.formRequestId ? `<button class="view-form-btn" data-request-id="${item.formRequestId}">View Form</button>` : 'N/A'}</td>
                <td><button class="action-btn" data-id="${item.id}">${item.status === 'pending_stores' ? 'Check' : 'Edit'}</button></td>
            `;
            tableBody.appendChild(row);
            if (item.formRequestId) {
                row.querySelector('.view-form-btn').addEventListener('click', () => openAssociatedForm(item.formRequestId));
            }
            row.querySelector('.action-btn').addEventListener('click', () => openDisposalModal({ target: { dataset: { id: item.id } } }));
        });
        updatePagination(paginationType, disposalData.length, pageInfoId);
    };

    // Populate all three tables with the same data
    populateTable(disposalTableBody, 'disposal', 'disposalPageInfo');
    populateTable(disposalFacultyTableBody, 'disposalFaculty', 'disposalFacultyPageInfo');
    populateTable(disposalStoresTableBody, 'disposalStores', 'disposalStoresPageInfo');

    localStorage.setItem('disposalData', JSON.stringify(disposalData));
}
    function populatePastDisposalsList(listId, pageKey) {
        const list = document.getElementById(listId);
        list.innerHTML = '';
        const items = paginate(pastDisposalsData, pagination[pageKey]);
        items.forEach(item => {
            list.innerHTML += `
                <div title="Disposed item">
                    ${item.id} - ${item.productName} - 
                    Disposed on: ${item.disposalDate || 'N/A'} ${item.disposalTime || ''} - 
                    Reason: ${item.reason} 
                    ${item.formRequestId ? `<button class="view-form-btn" data-request-id="${item.formRequestId}">View Form</button>` : ''}
                </div>`;
        });
        updatePagination(pageKey, pastDisposalsData.length, `${pageKey}PageInfo`);
        localStorage.setItem('pastDisposalsData', JSON.stringify(pastDisposalsData));
    }

    function populateAllTables() {
        populateMaintenanceTable();
        populateAlertsTable();
        populateStudentIssuesTable();
        populateInventoryTable();
        populateDisposalTables();
        updateCharts();
    }

    document.querySelectorAll('th[data-sort]').forEach(th => {
        th.addEventListener('click', () => {
            const key = th.dataset.sort;
            const tbodyId = th.closest('table').parentElement.parentElement.id.replace('Table', '');
            const dataMap = {
                maintenance: maintenanceData,
                alerts: alertsData,
                studentIssues: studentIssuesData.filter(item => currentFilter === 'all' || item.status === currentFilter),
                inventory: inventoryData,
                disposal: disposalData,
                disposalFaculty: disposalData
            };
            sortTable(dataMap[tbodyId], key, tbodyId);
            populateAllTables();
        });
    });

    document.getElementById('maintenancePrev').addEventListener('click', () => { if (pagination.maintenance > 1) { pagination.maintenance--; populateMaintenanceTable(); } });
    document.getElementById('maintenanceNext').addEventListener('click', () => { if (pagination.maintenance < Math.ceil(maintenanceData.length / rowsPerPage)) { pagination.maintenance++; populateMaintenanceTable(); } });
    document.getElementById('alertsPrev').addEventListener('click', () => { if (pagination.alerts > 1) { pagination.alerts--; populateAlertsTable(); } });
    document.getElementById('alertsNext').addEventListener('click', () => { if (pagination.alerts < Math.ceil(alertsData.length / rowsPerPage)) { pagination.alerts++; populateAlertsTable(); } });
    document.getElementById('studentIssuesPrev').addEventListener('click', () => { if (pagination.studentIssues > 1) { pagination.studentIssues--; populateStudentIssuesTable(); } });
    document.getElementById('studentIssuesNext').addEventListener('click', () => { if (pagination.studentIssues < Math.ceil(studentIssuesData.filter(item => currentFilter === 'all' || item.status === currentFilter).length / rowsPerPage)) { pagination.studentIssues++; populateStudentIssuesTable(); } });
    document.getElementById('inventoryPrev').addEventListener('click', () => { if (pagination.inventory > 1) { pagination.inventory--; populateInventoryTable(); } });
    document.getElementById('inventoryNext').addEventListener('click', () => { if (pagination.inventory < Math.ceil(inventoryData.length / rowsPerPage)) { pagination.inventory++; populateInventoryTable(); } });
    document.getElementById('disposalPrev').addEventListener('click', () => { if (pagination.disposal > 1) { pagination.disposal--; populateDisposalTables(); } });
    document.getElementById('disposalNext').addEventListener('click', () => { if (pagination.disposal < Math.ceil(disposalData.length / rowsPerPage)) { pagination.disposal++; populateDisposalTables(); } });
    document.getElementById('disposalFacultyPrev').addEventListener('click', () => { if (pagination.disposalFaculty > 1) { pagination.disposalFaculty--; populateDisposalTables(); } });
    document.getElementById('disposalFacultyNext').addEventListener('click', () => { if (pagination.disposalFaculty < Math.ceil(disposalData.length / rowsPerPage)) { pagination.disposalFaculty++; populateDisposalTables(); } });
    document.getElementById('disposalStoresPrev').addEventListener('click', () => { if (pagination.disposalStores > 1) { pagination.disposalStores--; populateDisposalTables(); } });
    document.getElementById('disposalStoresNext').addEventListener('click', () => { if (pagination.disposalStores < Math.ceil(disposalData.filter(item => item.status === 'pending_stores').length / rowsPerPage)) { pagination.disposalStores++; populateDisposalTables(); } });
    document.getElementById('pastDisposalsPrev').addEventListener('click', () => { if (pagination.pastDisposals > 1) { pagination.pastDisposals--; populatePastDisposalsList('pastDisposalsList', 'pastDisposals'); } });
    document.getElementById('pastDisposalsNext').addEventListener('click', () => { if (pagination.pastDisposals < Math.ceil(pastDisposalsData.length / rowsPerPage)) { pagination.pastDisposals++; populatePastDisposalsList('pastDisposalsList', 'pastDisposals'); } });
    document.getElementById('pastDisposalsFacultyPrev').addEventListener('click', () => { if (pagination.pastDisposalsFaculty > 1) { pagination.pastDisposalsFaculty--; populatePastDisposalsList('pastDisposalsListFaculty', 'pastDisposalsFaculty'); } });
    document.getElementById('pastDisposalsFacultyNext').addEventListener('click', () => { if (pagination.pastDisposalsFaculty < Math.ceil(pastDisposalsData.length / rowsPerPage)) { pagination.pastDisposalsFaculty++; populatePastDisposalsList('pastDisposalsListFaculty', 'pastDisposalsFaculty'); } });
    document.getElementById('pastDisposalsStoresPrev').addEventListener('click', () => { if (pagination.pastDisposalsStores > 1) { pagination.pastDisposalsStores--; populatePastDisposalsList('pastDisposalsListStores', 'pastDisposalsStores'); } });
    document.getElementById('pastDisposalsStoresNext').addEventListener('click', () => { if (pagination.pastDisposalsStores < Math.ceil(pastDisposalsData.length / rowsPerPage)) { pagination.pastDisposalsStores++; populatePastDisposalsList('pastDisposalsListStores', 'pastDisposalsStores'); } });

    inventoryStatusFilter.addEventListener('change', () => { pagination.inventory = 1; populateInventoryTable(); });
    maintenanceLabFilter.addEventListener('change', () => { pagination.maintenance = 1; populateMaintenanceTable(); });

    function checkAlerts() {
        const prevAlertsCount = alertsData.length;
        alertsData = maintenanceData.filter(item => new Date(item.dueDate) < today && !item.disposalPending);
        if (alertsData.length > prevAlertsCount && document.getElementById('enableNotifications').checked) {
            addNotification(`New alerts detected: ${alertsData.length - prevAlertsCount} item(s)`);
        }
        if (alertsData.length === 0 && notifications.length > 0) {
            notifications = [];
            notificationDot.classList.add('hidden');
        }
        populateAlertsTable();
    }

    function addNotification(message) {
        if (!notifications.some(n => n.message === message)) {
            notifications.push({ message, timestamp: new Date().toLocaleString() });
            notificationDot.classList.remove('hidden');
            updateNotificationPanel();
            if (document.getElementById('notificationSound').checked) {
                new Audio('https://www.soundjay.com/buttons/beep-01a.mp3').play().catch(() => {});
            }
            localStorage.setItem('notifications', JSON.stringify(notifications));
        }
    }

    function updateNotificationPanel() {
        notificationList.innerHTML = notifications.map(n => `<div class="notification-item">${n.timestamp}: ${n.message}</div>`).join('');
    }

    notificationBell.addEventListener('click', () => {
        notificationPanel.classList.toggle('active');
        updateNotificationPanel();
    });

    markAsReadBtn.addEventListener('click', () => {
        notifications = [];
        notificationDot.classList.add('hidden');
        updateNotificationPanel();
        notificationPanel.classList.remove('active');
        localStorage.setItem('notifications', JSON.stringify(notifications));
    });

    function initDisposalModule() {
    createParticles();
    renderCondemnationRequests();
    renderCondemnationRequestsStores();
}

    function createParticles() {
        const container = document.querySelector('.particle-container');
        for (let i = 0; i < 50; i++) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.style.cssText = `
                left: ${Math.random() * 100}%;
                top: ${Math.random() * 100}%;
                animation: float ${5 + Math.random() * 10}s infinite;
                background: radial-gradient(circle, 
                    rgba(0, 255, 255, 0.8) 20%, 
                    transparent 70%);
                width: 4px;
                height: 4px;
                border-radius: 50%;
            `;
            container.appendChild(particle);
        }
    }

    function openMaintenanceModal(e) {
        const id = e.target.dataset.id;
        const item = maintenanceData.find(i => i.id == id);
        document.getElementById('maintenanceId').value = id;
        document.getElementById('lastMaintenanceDate').value = item.lastMaintenance === '-' ? '' : item.lastMaintenance;
        updateMaintenanceModal.classList.remove('hidden');
    }

    document.getElementById('saveMaintenanceUpdate').addEventListener('click', () => {
        const id = parseInt(document.getElementById('maintenanceId').value);
        const date = document.getElementById('lastMaintenanceDate').value;
        const item = maintenanceData.find(i => i.id === id);
        item.lastMaintenance = date || '-';
        const dueDate = new Date(date || today);
        dueDate.setFullYear(dueDate.getFullYear() + 1);
        item.dueDate = dueDate.toISOString().split('T')[0];
        updateMaintenanceModal.classList.add('hidden');
        populateMaintenanceTable();
        checkAlerts();
    });

    document.getElementById('cancelMaintenanceUpdate').addEventListener('click', () => updateMaintenanceModal.classList.add('hidden'));

    disposalBtn.addEventListener('click', () => disposalRequestModal.classList.remove('hidden'));

    document.getElementById('sendDisposalRequest').addEventListener('click', () => {
    const selected = Array.from(maintenanceTableBody.querySelectorAll('input:checked'))
        .map(cb => maintenanceData.find(item => item.id == cb.dataset.id))
        .slice(0, 4);
    const reason = document.getElementById('disposalReason').value;

    if (!reason || selected.length === 0) {
        alert('Please select at least one item and provide a reason');
        return;
    }

    let disposalData = JSON.parse(localStorage.getItem('disposalData') || '[]');
    let condemnationForms = JSON.parse(localStorage.getItem('condemnationForms') || '[]');
    const requestId = `REQ-${Date.now()}`;
    const formItems = [];

    selected.forEach(item => {
        item.disposalPending = true;
        const disposalItem = {
            id: item.id,
            labName: item.labName,
            productName: item.productName,
            purchaseDate: item.purchaseDate,
            serviceProvider: item.serviceProvider,
            dueDate: item.dueDate,
            lastMaintenance: item.lastMaintenance,
            reason: reason,
            status: 'pending_assistant',
            formRequestId: requestId
        };
        if (!disposalData.some(d => String(d.id) === String(item.id))) {
            disposalData.push(disposalItem);
        }
        formItems.push({
            itemId: item.id,
            description: item.productName,
            purchaseDate: item.purchaseDate,
            reason: reason
        });
    });

    localStorage.setItem('disposalData', JSON.stringify(disposalData));
    condemnationForms.push({
        requestId: requestId,
        status: 'pending_assistant',
        items: formItems.map(item => ({ itemId: item.itemId, description: item.description }))
    });
    localStorage.setItem('condemnationForms', JSON.stringify(condemnationForms));
    localStorage.setItem('condemnationFormData', JSON.stringify(formItems));

    const profile = JSON.parse(localStorage.getItem('profile') || '{}');
    if (profile.role === 'Lab Assistant') {
        addNotification(`New disposal request #${requestId} submitted with ${selected.length} item(s).`);
    }

    window.open('condemnationFormsz.html', '_blank');
    disposalRequestModal.classList.add('hidden');
    document.getElementById('disposalReason').value = '';
    populateMaintenanceTable();
    populateDisposalTables();
});
    document.getElementById('cancelDisposalRequest').addEventListener('click', () => disposalRequestModal.classList.add('hidden'));

    updateRecordsBtn.addEventListener('click', () => {
        const selected = Array.from(alertsTableBody.querySelectorAll('input:checked'))
            .map(cb => alertsData.find(item => item.id == cb.dataset.id));
        selected.forEach(item => {
            item.lastMaintenance = today.toISOString().split('T')[0];
            const dueDate = new Date(today);
            dueDate.setFullYear(dueDate.getFullYear() + 1);
            item.dueDate = dueDate.toISOString().split('T')[0];
        });
        checkAlerts();
        populateMaintenanceTable();
    });

    function openUpdateIssueModal(e) {
        const id = parseInt(e.target.dataset.id);
        const item = studentIssuesData.find(i => i.id === id);
        document.getElementById('issueId').value = id;
        document.getElementById('studentName').value = item.studentName;
        document.getElementById('studentName').disabled = true;
        document.getElementById('issueLab').value = item.lab;
        document.getElementById('issueLab').disabled = true;
        document.getElementById('issueDetails').value = item.issue;
        document.getElementById('issueDetails').disabled = true;
        document.getElementById('issueStatus').innerHTML = `
            <option value="Pending" ${item.status === 'Pending' ? 'selected' : ''}>Pending</option>
            <option value="Resolved" ${item.status === 'Resolved' ? 'selected' : ''}>Resolved</option>`;
        document.getElementById('issueModalTitle').textContent = 'Update Issue';
        updateIssueModal.classList.remove('hidden');
    }

    addIssueBtn.addEventListener('click', () => {
        document.getElementById('issueId').value = '';
        document.getElementById('studentName').value = '';
        document.getElementById('studentName').disabled = false;
        document.getElementById('issueLab').value = 'Ip';
        document.getElementById('issueLab').disabled = false;
        document.getElementById('issueDetails').value = '';
        document.getElementById('issueDetails').disabled = false;
        document.getElementById('issueStatus').innerHTML = `
            <option value="Pending" selected>Pending</option>
            <option value="Resolved">Resolved</option>`;
        document.getElementById('issueModalTitle').textContent = 'Add New Issue';
        updateIssueModal.classList.remove('hidden');
    });

    document.getElementById('updateIssueBtn').addEventListener('click', () => {
        const id = document.getElementById('issueId').value;
        const data = {
            studentName: document.getElementById('studentName').value,
            lab: document.getElementById('issueLab').value,
            issue: document.getElementById('issueDetails').value,
            status: document.getElementById('issueStatus').value
        };
        if (!data.studentName || !data.issue) return;
        if (id) {
            const item = studentIssuesData.find(i => i.id == id);
            item.status = data.status;
        } else {
            data.id = studentIssuesData.length ? Math.max(...studentIssuesData.map(i => i.id)) + 1 : 301;
            studentIssuesData.push(data);
        }
        updateIssueModal.classList.add('hidden');
        populateStudentIssuesTable();
    });

    document.getElementById('discardIssueChanges').addEventListener('click', () => updateIssueModal.classList.add('hidden'));

    addInventoryBtn.addEventListener('click', () => {
        document.getElementById('newAssetId').value = '';
        document.getElementById('newAssetName').value = '';
        document.getElementById('newAssetCategory').value = '';
        document.getElementById('newAssetStatus').value = 'Active';
        addInventoryModal.classList.remove('hidden');
    });

    document.getElementById('saveAddInventory').addEventListener('click', () => {
        const data = {
            id: document.getElementById('newAssetId').value,
            name: document.getElementById('newAssetName').value,
            category: document.getElementById('newAssetCategory').value,
            status: document.getElementById('newAssetStatus').value
        };
        if (!data.id || !data.name || !data.category) return;
        inventoryData.push(data);
        addInventoryModal.classList.add('hidden');
        populateInventoryTable();
    });

    document.getElementById('cancelAddInventory').addEventListener('click', () => addInventoryModal.classList.add('hidden'));

    addMaintenanceBtn.addEventListener('click', () => {
        document.getElementById('newMaintenanceId').value = '';
        document.getElementById('newMaintenanceLabName').value = '';
        document.getElementById('newMaintenanceProductName').value = '';
        document.getElementById('newMaintenancePurchaseDate').value = '';
        document.getElementById('newMaintenanceServiceProvider').value = '';
        document.getElementById('newMaintenanceDueDate').value = '';
        document.getElementById('newMaintenanceLastMaintenance').value = '';
        addMaintenanceModal.classList.remove('hidden');
    });

    document.getElementById('saveAddMaintenance').addEventListener('click', () => {
        const data = {
            id: parseInt(document.getElementById('newMaintenanceId').value),
            labName: document.getElementById('newMaintenanceLabName').value,
            productName: document.getElementById('newMaintenanceProductName').value,
            purchaseDate: document.getElementById('newMaintenancePurchaseDate').value,
            serviceProvider: document.getElementById('newMaintenanceServiceProvider').value,
            dueDate: document.getElementById('newMaintenanceDueDate').value,
            lastMaintenance: document.getElementById('newMaintenanceLastMaintenance').value || '-',
            disposalPending: false
        };
        if (!data.id || !data.labName || !data.productName || !data.purchaseDate || !data.serviceProvider || !data.dueDate) return;
        maintenanceData.push(data);
        addMaintenanceModal.classList.add('hidden');
        populateMaintenanceTable();
        checkAlerts();
    });

    document.getElementById('cancelAddMaintenance').addEventListener('click', () => addMaintenanceModal.classList.add('hidden'));

    function openDisposalModal(e) {
        const id = parseInt(e.target.dataset.id);
        const item = disposalData.find(i => i.id === id);
        document.getElementById('disposalId').value = id;
        document.getElementById('disposalStatus').value = item.status.split(' on')[0];
        updateDisposalModal.classList.remove('hidden');
    }

    document.getElementById('updateDisposalStatus').addEventListener('click', () => {
        const id = parseInt(document.getElementById('disposalId').value);
        const status = document.getElementById('disposalStatus').value;
        const item = disposalData.find(i => i.id === id);
        const profile = JSON.parse(localStorage.getItem('profile') || '{}');
        if (item) {
            if (status === 'Approved, Disposed') {
                item.status = `${status} on ${today.toLocaleString()}`;
                item.disposedBy = profile.name || 'Unknown';
                pastDisposalsData.push({ ...item });
                disposalData = disposalData.filter(d => d.id !== id);
                maintenanceData = maintenanceData.filter(m => m.id !== id);
                addNotification(`Item ${item.productName} disposed by ${item.disposedBy}`);
            } else if (status === 'Approved') {
                item.status = `${status} on ${today.toLocaleString()}`;
                item.approvedBy = profile.name || 'Unknown';
                addNotification(`Item ${item.productName} approved by ${item.approvedBy}`);
            } else if (status === 'Rejected') {
                item.status = `${status} on ${today.toLocaleString()}`;
                const mItem = maintenanceData.find(m => m.id === id);
                if (mItem) mItem.disposalPending = false;
                disposalData = disposalData.filter(d => d.id !== id);
                addNotification(`Disposal request for ${item.productName} rejected`);
            } else {
                item.status = status;
            }
        }
        updateDisposalModal.classList.add('hidden');
        populateDisposalTables();
        populateMaintenanceTable();
        populatePastDisposalsList('pastDisposalsList', 'pastDisposals');
        populatePastDisposalsList('pastDisposalsListFaculty', 'pastDisposalsFaculty');
        updateCharts();
    });

    document.getElementById('cancelDisposalUpdate').addEventListener('click', () => updateDisposalModal.classList.add('hidden'));

    rejectDisposalFaculty.addEventListener('click', () => {
        const selected = Array.from(disposalFacultyTableBody.querySelectorAll('input:checked'))
            .map(cb => disposalData.find(item => item.id == cb.dataset.id));
        const profile = JSON.parse(localStorage.getItem('profile') || '{}');
        selected.forEach(item => {
            const mItem = maintenanceData.find(m => m.id === item.id);
            if (mItem) mItem.disposalPending = false;
            disposalData = disposalData.filter(d => d.id !== item.id);
            addNotification(`Disposal request for ${item.productName} rejected by ${profile.name || 'Unknown'}`);
        });
        populateDisposalTables();
        populateMaintenanceTable();
    });

    approveDisposalFaculty.addEventListener('click', () => {
        const selected = Array.from(disposalFacultyTableBody.querySelectorAll('input:checked'))
            .map(cb => disposalData.find(item => item.id == cb.dataset.id));
        const profile = JSON.parse(localStorage.getItem('profile') || '{}');
        selected.forEach(item => {
            item.status = `Approved on ${today.toLocaleString()}`;
            item.approvedBy = profile.name || 'Unknown';
            addNotification(`Disposal request for ${item.productName} approved by ${item.approvedBy}`);
        });
        populateDisposalTables();
    });

    showPastDisposalsBtn.addEventListener('click', () => {
        const list = document.getElementById('pastDisposalsList');
        list.classList.toggle('hidden');
        if (!list.classList.contains('hidden')) populatePastDisposalsList('pastDisposalsList', 'pastDisposals');
    });

    showPastDisposalsFacultyBtn.addEventListener('click', () => {
        const list = document.getElementById('pastDisposalsListFaculty');
        list.classList.toggle('hidden');
        if (!list.classList.contains('hidden')) populatePastDisposalsList('pastDisposalsListFaculty', 'pastDisposalsFaculty');
    });

    profileIcon.addEventListener('click', () => {
        const profile = JSON.parse(localStorage.getItem('profile') || '{}');
        if (!profile.name) {
            loadEditProfileModal();
        } else if (profile.photo

) {
            document.getElementById('profileModalTitle').textContent = 'Your Profile';
            document.getElementById('profileModalBody').innerHTML = `
                <div class="profile-pic-display" style="background-image: url(${profile.photo})"></div>
                <p>Name: ${profile.name || 'Not set'}</p>
                <p>Email: ${profile.email || 'Not set'}</p>
                <p>Role: ${profile.role || 'Not set'}</p>
                ${profile.role === 'Lab Faculty' || profile.role === 'Lab Assistant' ? `<p>Lab Name: ${profile.labName || 'Not set'}</p>` : ''}`;
            document.getElementById('profileModalFooter').innerHTML = `
                <button class="action-btn primary-btn" id="editProfileBtn">Edit Profile</button>`;
            document.getElementById('editProfileBtn').addEventListener('click', () => loadEditProfileModal());
        } else {
            loadEditProfileModal();
        }
        profileModal.classList.remove('hidden');
    });

    function loadEditProfileModal() {
        const profile = JSON.parse(localStorage.getItem('profile') || '{}');
        document.getElementById('profileModalTitle').textContent = 'Edit Profile';
        document.getElementById('profileModalBody').innerHTML = `
            <input type="file" id="profilePic" accept="image/*">
            <div class="profile-pic-display" style="background-image: url(${profile.photo || ''})" id="previewPic"></div>
            <label>Name:</label><input type="text" id="profileName" value="${profile.name || ''}" required>
            <label>Email:</label><input type="email" id="profileEmail" value="${profile.email || ''}" required>
            <label>Role:</label><select id="profileRole" onchange="toggleLabNameField()">
                <option value="Admin" ${profile.role === 'Admin' ? 'selected' : ''}>Admin</option>
                <option value="Hod" ${profile.role === 'Hod' ? 'selected' : ''}>Hod</option>
                <option value="Lab Faculty" ${profile.role === 'Lab Faculty' ? 'selected' : ''}>Lab Faculty</option>
                <option value="Lab Assistant" ${profile.role === 'Lab Assistant' ? 'selected' : ''}>Lab Assistant</option>
                <option value="Stores" ${profile.role === 'Stores' ? 'selected' : ''}>Stores</option>
            </select>
            <div id="labNameField" style="display: ${profile.role === 'Lab Faculty' || profile.role === 'Lab Assistant' ? 'block' : 'none'};">
                <label>Lab Name:</label><select id="profileLabName">
                    <option value="Ip" ${profile.labName === 'Ip' ? 'selected' : ''}>Ip</option>
                    <option value="Funds" ${profile.labName === 'Funds' ? 'selected' : ''}>Funds</option>
                    <option value="Mpmc" ${profile.labName === 'Mpmc' ? 'selected' : ''}>Mpmc</option>
                    <option value="DS" ${profile.labName === 'DS' ? 'selected' : ''}>DS</option>
                    <option value="AI" ${profile.labName === 'AI' ? 'selected' : ''}>AI</option>
                    <option value="ML" ${profile.labName === 'ML' ? 'selected' : ''}>ML</option>
                </select>
            </div>`;
        document.getElementById('profileModalFooter').innerHTML = `
            <button class="action-btn" id="cancelProfileUpdate">Cancel</button>
            <button class="action-btn primary-btn" id="saveProfile">Save</button>`;
        document.getElementById('profilePic').addEventListener('change', previewProfilePic);
        document.getElementById('saveProfile').addEventListener('click', saveProfile);
        document.getElementById('cancelProfileUpdate').addEventListener('click', () => profileModal.classList.add('hidden'));
    }

    function previewProfilePic() {
        const file = document.getElementById('profilePic').files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = () => {
                document.getElementById('previewPic').style.backgroundImage = `url(${reader.result})`;
            };
            reader.readAsDataURL(file);
        }
    }

    function toggleLabNameField() {
        const role = document.getElementById('profileRole').value;
        document.getElementById('labNameField').style.display = role === 'Lab Faculty' || role === 'Lab Assistant' ? 'block' : 'none';
    }

    function saveProfile() {
        const file = document.getElementById('profilePic').files[0];
        const name = document.getElementById('profileName').value;
        const email = document.getElementById('profileEmail').value;
        const role = document.getElementById('profileRole').value;
        const labName = (role === 'Lab Faculty' || role === 'Lab Assistant') ? document.getElementById('profileLabName').value : '';
        if (!name || !email) {
            alert('Name and Email are required!');
            return;
        }
        const profile = { name, email, role, labName };
        if (file) {
            const reader = new FileReader();
            reader.onload = () => {
                profile.photo = reader.result;
                localStorage.setItem('profile', JSON.stringify(profile));
                profileIcon.style.backgroundImage = `url(${reader.result})`;
                profileIcon.textContent = '';
                profileModal.classList.add('hidden');
                loadProfile();
                updateWelcomeMessage();
            };
            reader.readAsDataURL(file);
        } else {
            const existingProfile = JSON.parse(localStorage.getItem('profile') || '{}');
            profile.photo = existingProfile.photo || '';
            localStorage.setItem('profile', JSON.stringify(profile));
            profileModal.classList.add('hidden');
            loadProfile();
            updateWelcomeMessage();
        }
    }

    function loadProfile() {
        const profile = JSON.parse(localStorage.getItem('profile') || '{}');
        if (profile.photo) {
            profileIcon.style.backgroundImage = `url(${profile.photo})`;
            profileIcon.style.backgroundSize = 'cover';
            profileIcon.style.backgroundPosition = 'center';
            profileIcon.textContent = '';
        } else {
            profileIcon.style.backgroundImage = '';
            profileIcon.textContent = '';
        }
    }

    function updateWelcomeMessage() {
        const profile = JSON.parse(localStorage.getItem('profile') || '{}');
        welcomeMessage.textContent = `Welcome, ${profile.name || 'Guest'}!`;
    }

    document.querySelectorAll('.close-modal').forEach(btn => btn.addEventListener('click', () => btn.closest('.modal').classList.add('hidden')));

    function initCharts() {
        maintenanceChart = new Chart(document.getElementById('maintenanceOverviewChart'), {
            type: 'pie',
            data: {
                labels: ['Total Items', 'Alerts'],
                datasets: [{ 
                    data: [0, 0], 
                    backgroundColor: ['#006666', '#A9B7C0'],
                    borderColor: ['#FFFFFF', '#FFFFFF'],
                    borderWidth: 2
                }]
            },
            options: { 
                responsive: true, 
                maintainAspectRatio: false,
                plugins: {
                    tooltip: {
                        backgroundColor: 'rgba(0, 102, 102, 0.8)',
                        titleFont: { family: 'Orbitron' },
                        bodyFont: { family: 'Orbitron' }
                    }
                }
            }
        });

        studentIssuesChart = new Chart(document.getElementById('studentIssuesChart'), {
            type: 'pie',
            data: {
                labels: ['Pending', 'Resolved'],
                datasets: [{ 
                    data: [0, 0], 
                    backgroundColor: ['#A9B7C0', '#006666'],
                    borderColor: ['#FFFFFF', '#FFFFFF'],
                    borderWidth: 2
                }]
            },
            options: { 
                responsive: true, 
                maintainAspectRatio: false,
                plugins: {
                    tooltip: {
                        backgroundColor: 'rgba(0, 102, 102, 0.8)',
                        titleFont: { family: 'Orbitron' },
                        bodyFont: { family: 'Orbitron' }
                    }
                }
            }
        });
        updateCharts();
    }

    function updateCharts() {
        if (document.getElementById('maintenance').classList.contains('active')) {
            maintenanceChart.data.datasets[0].data = [maintenanceData.length, alertsData.length];
            maintenanceChart.update();
        }
        if (document.getElementById('student-issues').classList.contains('active')) {
            studentIssuesChart.data.datasets[0].data = [
                studentIssuesData.filter(i => i.status === 'Pending').length,
                studentIssuesData.filter(i => i.status === 'Resolved').length
            ];
            studentIssuesChart.update();
        }
    }

    searchInput.addEventListener('input', () => {
        const query = searchInput.value.toLowerCase();
        const activeModule = document.querySelector('.module.active');
        const tbody = activeModule.querySelector('tbody');
        if (tbody) {
            Array.from(tbody.rows).forEach(row => {
                const text = Array.from(row.cells).map(c => c.textContent.toLowerCase()).join(' ');
                row.style.display = text.includes(query) ? '' : 'none';
            });
        }
    });

    showPendingBtn.addEventListener('click', () => {
        if (currentFilter === 'Pending') {
            currentFilter = 'all';
            showPendingBtn.classList.remove('active');
        } else {
            currentFilter = 'Pending';
            showPendingBtn.classList.add('active');
            showResolvedBtn.classList.remove('active');
        }
        pagination.studentIssues = 1;
        populateStudentIssuesTable();
    });

    showResolvedBtn.addEventListener('click', () => {
        if (currentFilter === 'Resolved') {
            currentFilter = 'all';
            showResolvedBtn.classList.remove('active');
        } else {
            currentFilter = 'Resolved';
            showResolvedBtn.classList.add('active');
            showPendingBtn.classList.remove('active');
        }
        pagination.studentIssues = 1;
        populateStudentIssuesTable();
    });

    document.getElementById('themeSelect').addEventListener('change', (e) => {
        document.body.setAttribute('data-theme', e.target.value);
    });

    document.getElementById('rowsPerPage').addEventListener('change', (e) => {
        rowsPerPage = parseInt(e.target.value);
        Object.keys(pagination).forEach(key => pagination[key] = 1);
        populateAllTables();
    });

    document.getElementById('resetProfile').addEventListener('click', () => {
        localStorage.removeItem('profile');
        loadProfile();
        updateWelcomeMessage();
        alert('Profile reset successfully!');
    });

    document.getElementById('clearData').addEventListener('click', () => {
        if (confirm('Are you sure you want to clear all data?')) {
            maintenanceData = [];
            studentIssuesData = [];
            disposalData = [];
            pastDisposalsData = [];
            inventoryData = [];
            alertsData = [];
            notifications = [];
            localStorage.clear();
            populateAllTables();
            notificationDot.classList.add('hidden');
            alert('All data cleared!');
        }
    });

    function showEasterEgg() {
        alert('ðŸŽ‰ Easter Egg Unlocked: Welcome to the Future of Asset Management!');
    }

    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            document.querySelectorAll('.modal:not(.hidden)').forEach(modal => modal.classList.add('hidden'));
            notificationPanel.classList.remove('active');
        }
    });

    function openAssociatedForm(requestId) {
        window.open(`condemnationFormsz.html?requestId=${requestId}`, '_blank');
    }

    window.onload = function() {
    init();
    // Handle initial hash on load
    const hash = window.location.hash;
    if (hash === '#disposal') {
        setActiveModule('disposal');
        populateDisposalTables();
        renderCondemnationRequests();
        renderCondemnationRequestsStores(); // Ensure Stores view updates too
    }
    // Handle hash changes dynamically
    window.addEventListener('hashchange', () => {
        if (window.location.hash === '#disposal') {
            setActiveModule('disposal');
            populateDisposalTables();
            renderCondemnationRequests();
            renderCondemnationRequestsStores();
        }
    });
    // Existing message handler for popup case
    window.addEventListener('message', (event) => {
        if (event.data.success) {
            const requestId = event.data.requestId;
            const type = event.data.type;
            const formData = event.data.formData;
            let disposalData = JSON.parse(localStorage.getItem('disposalData') || '[]');
            let condemnationForms = JSON.parse(localStorage.getItem('condemnationForms') || '[]');
            const profile = JSON.parse(localStorage.getItem('profile') || '{}');

            if (type === 'formSubmitted') {
                formData.items.forEach(item => {
                    const existingItem = disposalData.find(d => String(d.id) === String(item.itemId));
                    if (!existingItem) {
                        disposalData.push({
                            id: item.itemId || `ID${Date.now()}-${Math.floor(Math.random() * 1000)}`,
                            labName: item.labName || 'Unknown',
                            productName: item.description || 'Unnamed Item',
                            purchaseDate: item.purchaseDate || 'N/A',
                            serviceProvider: 'Unknown',
                            dueDate: 'N/A',
                            lastMaintenance: '-',
                            reason: item.reason || 'Not specified',
                            quantity: item.quantity || '',
                            bookValue: item.bookValue || '',
                            unserviceableDate: item.unserviceableDate || '',
                            periodOfUse: item.periodOfUse || '',
                            condition: item.condition || '',
                            repairEfforts: item.repairEfforts || '',
                            location: item.location || '',
                            remarks: item.remarks || '',
                            status: 'pending_assistant',
                            formRequestId: requestId
                        });
                    }
                });
                addNotification(`New disposal request #${requestId} submitted with ${formData.items.length} item(s).`);
            } else if (type === 'assistantUpdateSubmit') {
                formData.items.forEach(item => {
                    const disposalItem = disposalData.find(d => String(d.id) === String(item.itemId));
                    if (disposalItem) {
                        Object.assign(disposalItem, {
                            status: 'pending_stores',
                            productName: item.description || disposalItem.productName,
                            purchaseDate: item.purchaseDate || disposalItem.purchaseDate,
                            reason: item.reason || disposalItem.reason,
                            labName: item.labName || disposalItem.labName,
                            quantity: item.quantity || disposalItem.quantity,
                            bookValue: item.bookValue || disposalItem.bookValue,
                            unserviceableDate: item.unserviceableDate || disposalItem.unserviceableDate,
                            periodOfUse: item.periodOfUse || disposalItem.periodOfUse,
                            condition: item.condition || disposalItem.condition,
                            repairEfforts: item.repairEfforts || disposalItem.repairEfforts,
                            location: item.location || disposalItem.location,
                            remarks: item.remarks || disposalItem.remarks,
                            formRequestId: requestId
                        });
                    }
                });
                addNotification(`Disposal request #${requestId} updated and submitted to Stores with ${formData.items.length} item(s).`);
            } else if (type === 'storesUpdateSave') {
                formData.items.forEach(item => {
                    const disposalItem = disposalData.find(d => String(d.id) === String(item.itemId));
                    if (disposalItem) {
                        disposalItem.status = `Approved, Disposed on ${new Date().toLocaleString()}`;
                        disposalItem.disposedBy = profile.name || 'Unknown';
                        pastDisposalsData.push({ ...disposalItem, disposalDate: new Date().toISOString().split('T')[0], disposalTime: new Date().toLocaleTimeString() });
                        disposalData = disposalData.filter(d => String(d.id) !== String(item.itemId));
                        maintenanceData = maintenanceData.filter(m => String(m.id) !== String(item.itemId));
                        addNotification(`Item ${disposalItem.productName} disposed by ${disposalItem.disposedBy}`);
                    }
                });
            }

            const formIndex = condemnationForms.findIndex(f => f.requestId === requestId);
            if (formIndex > -1) {
                condemnationForms[formIndex] = formData;
            } else {
                condemnationForms.push(formData);
            }

            localStorage.setItem('disposalData', JSON.stringify(disposalData));
            localStorage.setItem('condemnationForms', JSON.stringify(condemnationForms));
            localStorage.setItem('maintenanceData', JSON.stringify(maintenanceData));
            localStorage.setItem('pastDisposalsData', JSON.stringify(pastDisposalsData));
            populateDisposalTables();
            renderCondemnationRequests();
            renderCondemnationRequestsStores();
        }
    });
};
</script>
</body>
</html>








 
